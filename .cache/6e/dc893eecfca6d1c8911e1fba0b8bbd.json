{"id":"Oy4H","dependencies":[{"name":"/Users/m/www/oio/land/oio.radio/package.json","includedInParent":true,"mtime":1585391671622},{"name":"/Users/m/www/oio/land/oio.radio/node_modules/tabletop/package.json","includedInParent":true,"mtime":1585391574027},{"name":"request","loc":{"line":10,"column":22},"parent":"/Users/m/www/oio/land/oio.radio/node_modules/tabletop/src/tabletop.js","resolved":"/Users/m/www/oio/land/oio.radio/node_modules/request/index.js"},{"name":"process","parent":"/Users/m/www/oio/land/oio.radio/node_modules/tabletop/src/tabletop.js","resolved":"/Users/m/.config/yarn/global/node_modules/process/browser.js"}],"generated":{"js":"var process = require(\"process\");\nvar define;\nvar e,t=require(\"process\");!function(){\"use strict\";var s=void 0!==t&&!1,o=function(){throw new Error(\"The 'request' module is only available while running in Node.\")};s&&(o=require(\"request\"));var n=!1,h=!1;try{void 0!==(new XMLHttpRequest).withCredentials?n=!0:\"XDomainRequest\"in window&&(n=!0,h=!0)}catch(d){}var a=Array.prototype.indexOf,r=function(e,t){var s=0,i=e.length;if(a&&e.indexOf===a)return e.indexOf(t);for(;s<i;s++)if(e[s]===t)return s;return-1},l=function(e){return this&&this instanceof l?(\"string\"==typeof e&&(e={key:e}),this.callback=e.callback,this.error=e.error,this.wanted=e.wanted||[],this.key=e.key,this.simpleSheet=!!e.simpleSheet,this.parseNumbers=!!e.parseNumbers,this.wait=!!e.wait,this.reverse=!!e.reverse,this.postProcess=e.postProcess,this.debug=!!e.debug,this.query=e.query||\"\",this.orderby=e.orderby,this.endpoint=e.endpoint||\"https://spreadsheets.google.com\",this.singleton=!!e.singleton,this.simpleUrl=!(!e.simpleUrl&&!e.simple_url),this.authkey=e.authkey,this.sheetPrivacy=this.authkey?\"private\":\"public\",this.callbackContext=e.callbackContext,this.prettyColumnNames=void 0===e.prettyColumnNames?!e.proxy:e.prettyColumnNames,void 0!==e.proxy&&(this.endpoint=e.proxy.replace(/\\/$/,\"\"),this.simpleUrl=!0,this.singleton=!0,n=!1),this.parameterize=e.parameterize||!1,this.singleton&&(void 0!==l.singleton&&this.log(\"WARNING! Tabletop singleton already defined\"),l.singleton=this),/key=/.test(this.key)&&(this.log(\"You passed an old Google Docs url as the key! Attempting to parse.\"),this.key=this.key.match(\"key=(.*?)(&|#|$)\")[1]),/pubhtml/.test(this.key)&&(this.log(\"You passed a new Google Spreadsheets url as the key! Attempting to parse.\"),this.key=this.key.match(\"d\\\\/(.*?)\\\\/pubhtml\")[1]),/spreadsheets\\/d/.test(this.key)&&(this.log(\"You passed the most recent version of Google Spreadsheets url as the key! Attempting to parse.\"),this.key=this.key.match(\"d\\\\/(.*?)/\")[1]),this.key?(this.log(\"Initializing with key \"+this.key),this.models={},this.modelNames=[],this.model_names=this.modelNames,this.baseJsonPath=\"/feeds/worksheets/\"+this.key+\"/\"+this.sheetPrivacy+\"/basic?alt=\",this.baseJsonPath+=s||n?\"json\":\"json-in-script\",this.authkey&&(this.baseJsonPath+=\"&oauth_token=\"+this.authkey),this.wait?void 0:this.fetch()):void this.log(\"You need to pass Tabletop a key!\")):new l(e)};l.callbacks={},l.init=function(e){return new l(e)},l.sheets=function(){this.log(\"Times have changed! You'll want to use var tabletop = Tabletop.init(...); tabletop.sheets(...); instead of Tabletop.sheets(...)\")},l.prototype={fetch:function(e){var t=this;return new Promise(function(s,i){void 0!==e&&(t.callback=e),t.callback||(t.callback=s),t.error||(t.error=i),t.requestData(t.baseJsonPath,t.loadSheets)})},requestData:function(e,t){if(this.log(\"Requesting\",e),this.encounteredError=!1,s)this.serverSideFetch(e,t);else{var i=this.endpoint.split(\"//\").shift()||\"http\";!n||h&&i!==location.protocol?this.injectScript(e,t):this.xhrFetch(e,t)}},xhrFetch:function(e,t){var s=h?new XDomainRequest:new XMLHttpRequest;s.open(\"GET\",this.endpoint+e);var i=this;s.onload=function(){var e;try{e=JSON.parse(s.responseText)}catch(d){console.error(d)}t.call(i,e)},this.error&&s.addEventListener(\"error\",this.error),s.send()},injectScript:function(e,t){var s,i=document.createElement(\"script\");if(this.singleton)t===this.loadSheets?s=\"Tabletop.singleton.loadSheets\":t===this.loadSheet&&(s=\"Tabletop.singleton.loadSheet\");else{var o=this;s=\"tt\"+ +new Date+Math.floor(1e5*Math.random()),l.callbacks[s]=function(){var e=Array.prototype.slice.call(arguments,0);t.apply(o,e),i.parentNode.removeChild(i),delete l.callbacks[s]},s=\"Tabletop.callbacks.\"+s}var n=e+\"&callback=\"+s;this.simpleUrl?-1!==e.indexOf(\"/list/\")?i.src=this.endpoint+\"/\"+this.key+\"-\"+e.split(\"/\")[4]:i.src=this.endpoint+\"/\"+this.key:i.src=this.endpoint+n,this.parameterize&&(i.src=this.parameterize+encodeURIComponent(i.src)),this.log(\"Injecting\",i.src),document.getElementsByTagName(\"script\")[0].parentNode.appendChild(i)},serverSideFetch:function(e,t){var s=this;this.log(\"Fetching\",this.endpoint+e),o({url:this.endpoint+e,json:!0},function(e,i,o){if(e)return console.error(e);t.call(s,o)})},isWanted:function(e){return 0===this.wanted.length||-1!==r(this.wanted,e)},data:function(){if(0!==this.modelNames.length)return this.simpleSheet?(this.modelNames.length>1&&this.debug&&this.log(\"WARNING You have more than one sheet but are using simple sheet mode! Don't blame me when something goes wrong.\"),this.models[this.modelNames[0]].all()):this.models},addWanted:function(e){-1===r(this.wanted,e)&&this.wanted.push(e)},loadSheets:function(e){var t,i,o=[];try{this.googleSheetName=e.feed.title.$t}catch(l){return void this.error(l)}for(this.foundSheetNames=[],t=0,i=e.feed.entry.length;t<i;t++)if(this.foundSheetNames.push(e.feed.entry[t].title.$t),this.isWanted(e.feed.entry[t].content.$t)){var h=e.feed.entry[t].link.length-1,a=e.feed.entry[t].link[h].href.split(\"/\").pop(),r=\"/feeds/list/\"+this.key+\"/\"+a+\"/\"+this.sheetPrivacy+\"/values?alt=\";r+=s||n?\"json\":\"json-in-script\",this.query&&(r+=\"&tq=\"+this.query),this.orderby&&(r+=\"&orderby=column:\"+this.orderby.toLowerCase()),this.reverse&&(r+=\"&reverse=true\"),this.authkey&&(r+=\"&oauth_token=\"+this.authkey),o.push(r)}for(this.sheetsToLoad=o.length,t=0,i=o.length;t<i;t++)this.requestData(o[t],this.loadSheet)},sheets:function(e){return void 0===e?this.models:void 0===this.models[e]?void 0:this.models[e]},sheetReady:function(e){this.models[e.name]=e,-1===r(this.modelNames,e.name)&&this.modelNames.push(e.name),this.sheetsToLoad--,0===this.sheetsToLoad&&this.doCallback()},loadSheet:function(e){var t=this;new l.Model({data:e,parseNumbers:this.parseNumbers,postProcess:this.postProcess,tabletop:this,prettyColumnNames:this.prettyColumnNames,onReady:function(){t.sheetReady(this)}})},doCallback:function(){0===this.sheetsToLoad&&this.callback.apply(this.callbackContext||this,[this.data(),this])},log:function(){this.debug&&\"undefined\"!=typeof console&&void 0!==console.log&&Function.prototype.apply.apply(console.log,[console,arguments])}},l.Model=function(e){var t,s,i,o;if(this.columnNames=[],this.column_names=this.columnNames,this.name=e.data.feed.title.$t,this.tabletop=e.tabletop,this.elements=[],this.onReady=e.onReady,this.raw=e.data,void 0===e.data.feed.entry)return e.tabletop.log(\"Missing data for \"+this.name+\", make sure you didn't forget column headers\"),this.originalColumns=[],this.elements=[],void this.ready();for(var n in e.data.feed.entry[0])/^gsx/.test(n)&&this.columnNames.push(n.replace(\"gsx$\",\"\"));for(this.originalColumns=this.columnNames,this.original_columns=this.originalColumns,t=0,i=e.data.feed.entry.length;t<i;t++){var h=e.data.feed.entry[t],a={};for(s=0,o=this.columnNames.length;s<o;s++){var r=h[\"gsx$\"+this.columnNames[s]];void 0!==r?e.parseNumbers&&\"\"!==r.$t&&!isNaN(r.$t)?a[this.columnNames[s]]=+r.$t:a[this.columnNames[s]]=r.$t:a[this.columnNames[s]]=\"\"}void 0===a.rowNumber&&(a.rowNumber=t+1),this.elements.push(a)}e.prettyColumnNames?this.fetchPrettyColumns():this.ready()},l.Model.prototype={all:function(){return this.elements},fetchPrettyColumns:function(){if(!this.raw.feed.link[3])return this.ready();var e=this.raw.feed.link[3].href.replace(\"/feeds/list/\",\"/feeds/cells/\").replace(\"https://spreadsheets.google.com\",\"\"),t=this;this.tabletop.requestData(e,function(e){t.loadPrettyColumns(e)})},beforeReady:function(){if(this.postProcess)for(i=0,ilen=this.elements.length;i<ilen;i++)this.postProcess(element)},ready:function(){this.beforeReady(),this.onReady.call(this)},loadPrettyColumns:function(e){for(var t={},s=this.columnNames,i=0,o=s.length;i<o;i++)void 0!==e.feed.entry[i].content.$t?t[s[i]]=e.feed.entry[i].content.$t:t[s[i]]=s[i];this.prettyColumns=t,this.pretty_columns=this.prettyColumns,this.prettifyElements(),this.ready()},prettifyElements:function(){var e,t,s,i,o=[],n=[];for(t=0,i=this.columnNames.length;t<i;t++)n.push(this.prettyColumns[this.columnNames[t]]);for(e=0,s=this.elements.length;e<s;e++){var h={};for(t=0,i=this.columnNames.length;t<i;t++){h[this.prettyColumns[this.columnNames[t]]]=this.elements[e][this.columnNames[t]]}o.push(h)}this.elements=o,this.columnNames=n},toArray:function(){var e,t,s,i,o=[];for(e=0,s=this.elements.length;e<s;e++){var n=[];for(t=0,i=this.columnNames.length;t<i;t++)n.push(this.elements[e][this.columnNames[t]]);o.push(n)}return o}},\"undefined\"!=typeof module&&module.exports?module.exports=l:\"function\"==typeof e&&e.amd?e(function(){return l}):window.Tabletop=l}();"},"sourceMaps":null,"error":null,"hash":"33d99376c1e4c00408e12ec41eaceeaf","cacheData":{"env":{}}}